üîù Retour au [Sommaire](/SOMMAIRE.md)

# 2.3 - Gestion des tokens d'acc√®s

## üéØ Introduction

Les tokens d'acc√®s sont le c≈ìur de la s√©curit√© de votre CLI GitHub. Bien que vous ayez d√©j√† utilis√© l'authentification automatique, comprendre et ma√Ætriser les tokens vous donnera un contr√¥le total sur la s√©curit√© et les permissions de vos acc√®s GitHub.

**Analogie** : Si l'authentification automatique est comme avoir un pass universel, les tokens sont comme avoir des cartes d'acc√®s sp√©cialis√©es pour chaque situation - plus s√©curis√© et plus flexible !

## üîë Qu'est-ce qu'un token d'acc√®s ?

### D√©finition simple

Un **token d'acc√®s personnel (PAT - Personal Access Token)** est une **cl√© digitale unique** qui permet √† votre CLI GitHub de s'identifier aupr√®s de GitHub et d'effectuer des actions en votre nom.

### Analogie concr√®te

Imaginez un h√¥tel avec diff√©rents types de cartes :
- **Carte client** : Acc√®s √† votre chambre seulement
- **Carte employ√©** : Acc√®s aux zones de service
- **Carte manager** : Acc√®s aux bureaux administratifs
- **Carte master** : Acc√®s partout

Les tokens fonctionnent de la m√™me mani√®re : chaque token a des **permissions sp√©cifiques** selon son usage.

### Diff√©rence avec les mots de passe

| Aspect | Mot de passe | Token d'acc√®s |
|--------|-------------|---------------|
| **Port√©e** | Acc√®s complet au compte | Permissions sp√©cifiques |
| **Dur√©e** | Permanent (jusqu'√† changement) | Expiration configurable |
| **R√©vocation** | Change tout l'acc√®s | R√©vocable individuellement |
| **Usage** | Interface web principalement | APIs et outils CLI |
| **Visibilit√©** | Cach√© | Partiellement visible |

## üõ°Ô∏è Pourquoi utiliser des tokens ?

### 1. **S√©curit√© renforc√©e**

**Principe du moindre privil√®ge** : Donnez seulement les permissions n√©cessaires.

**Exemple concret** :
- Script de backup : Token avec permission "lecture seule"
- CI/CD : Token avec permissions "workflow" et "packages"
- Administration : Token avec permissions √©tendues

### 2. **Contr√¥le granulaire**

```bash
# Token pour contribution open source (lecture publique seulement)
Permissions : public_repo

# Token pour d√©veloppement personnel (tous vos repos)
Permissions : repo, workflow, user

# Token pour administration d'organisation
Permissions : repo, workflow, admin:org, delete_repo
```

### 3. **Tra√ßabilit√©**

Chaque token a :
- **Un nom descriptif** : "CI Server Production"
- **Une date de cr√©ation** et d'expiration
- **Un historique d'utilisation**

### 4. **R√©vocation facile**

**Probl√®me de s√©curit√© ?** R√©voquez juste le token concern√© sans impacter les autres acc√®s.

## üîß Types de tokens

### 1. Classic Personal Access Tokens

**Les tokens traditionnels** - simples et directs :

#### Avantages
- ‚úÖ **Simples** √† cr√©er et utiliser
- ‚úÖ **Compatibles** avec tous les outils
- ‚úÖ **Contr√¥le** des permissions par scope

#### Inconv√©nients
- ‚ö†Ô∏è **Permissions larges** par scope
- ‚ö†Ô∏è **Acc√®s** √† toutes les organisations

### 2. Fine-grained Personal Access Tokens (Beta)

**Les nouveaux tokens** - contr√¥le ultra-pr√©cis :

#### Avantages
- ‚úÖ **Permissions tr√®s sp√©cifiques** par repository
- ‚úÖ **Acc√®s limit√©** aux organisations choisies
- ‚úÖ **Dur√©e de vie** plus courte par d√©faut

#### Inconv√©nients
- ‚ö†Ô∏è **Encore en beta** (peut changer)
- ‚ö†Ô∏è **Plus complexe** √† configurer

**Pour d√©buter** : Utilisez les Classic PAT, plus stables et simples.

## üé® Cr√©er votre premier token

### √âtape 1 : Acc√©der √† la gestion des tokens

1. **Allez sur [github.com](https://github.com)**
2. **Cliquez sur votre photo** de profil (en haut √† droite)
3. **S√©lectionnez "Settings"**
4. **Dans le menu de gauche** : "Developer settings" (tout en bas)
5. **Cliquez sur** "Personal access tokens"
6. **S√©lectionnez** "Tokens (classic)"

### √âtape 2 : G√©n√©rer un nouveau token

1. **Cliquez sur** "Generate new token" ‚Üí "Generate new token (classic)"
2. **Autorisez avec votre mot de passe** ou 2FA si demand√©

### √âtape 3 : Configurer le token

#### Nom du token (Note)
**Soyez descriptif !** Exemples :
- ‚úÖ "CLI GitHub - PC Personnel"
- ‚úÖ "Script Backup Repos"
- ‚úÖ "CI/CD Server Production"
- ‚ùå "Mon token" (trop vague)

#### Expiration
**Recommandations par usage** :
- **D√©veloppement local** : 90 jours (√©quilibre s√©curit√©/praticit√©)
- **Scripts personnels** : 1 an
- **CI/CD** : Pas d'expiration (mais surveillance renforc√©e)
- **Tests/exp√©rimentation** : 30 jours

#### S√©lection des permissions (Scopes)

**Voici les scopes les plus courants** :

##### Permissions de base
```
‚úÖ repo                    # Acc√®s complet aux repositories priv√©s
‚úÖ public_repo             # Acc√®s aux repositories publics seulement
‚úÖ repo:status             # Statut des commits seulement
‚úÖ repo_deployment         # D√©ploiements seulement
```

##### Permissions workflow
```
‚úÖ workflow                # GitHub Actions
‚úÖ write:packages          # Publier des packages
‚úÖ read:packages           # Lire des packages
‚úÖ delete:packages         # Supprimer des packages
```

##### Permissions utilisateur
```
‚úÖ user                    # Acc√®s au profil utilisateur
‚úÖ user:email              # Adresses email seulement
‚úÖ user:follow             # Suivre/ne plus suivre
```

##### Permissions organisation
```
‚úÖ admin:org               # Administration compl√®te
‚úÖ write:org               # √âcriture dans l'organisation
‚úÖ read:org                # Lecture de l'organisation
```

### √âtape 4 : Sauvegarder le token

1. **Cliquez sur** "Generate token"
2. **Copiez IMM√âDIATEMENT** le token affich√©
3. **Sauvegardez-le** dans un gestionnaire de mots de passe

‚ö†Ô∏è **ATTENTION** : Vous ne pourrez plus jamais revoir ce token ! Si vous le perdez, il faudra en cr√©er un nouveau.

## üîß Utiliser un token avec la CLI

### M√©thode 1 : Authentification directe

```bash
gh auth login --with-token
```

Puis **collez votre token** et appuyez sur Entr√©e.

### M√©thode 2 : Variable d'environnement

```bash
# D√©finir la variable d'environnement
export GITHUB_TOKEN="ghp_votre_token_ici"

# La CLI utilisera automatiquement cette variable
gh repo list
```

### M√©thode 3 : Fichier token (temporaire)

```bash
# Cr√©er un fichier temporaire avec le token
echo "ghp_votre_token_ici" > token.txt

# Utiliser le fichier pour l'authentification
gh auth login --with-token < token.txt

# Supprimer le fichier (s√©curit√©)
rm token.txt
```

### M√©thode 4 : Script s√©curis√©

```bash
#!/bin/bash
# auth-script.sh

# Demander le token de mani√®re s√©curis√©e
echo -n "Token GitHub: "
read -s GITHUB_TOKEN
echo

# Authentifier
echo "$GITHUB_TOKEN" | gh auth login --with-token

# Nettoyer la variable
unset GITHUB_TOKEN

echo "Authentification termin√©e !"
```

## üéØ Tokens par cas d'usage

### D√©veloppeur personnel

**Besoins** : Acc√®s √† vos repos personnels, cr√©ation d'issues, PRs.

**Permissions recommand√©es** :
```
‚úÖ repo           # Tous vos repositories
‚úÖ workflow       # GitHub Actions
‚úÖ user           # Votre profil
‚úÖ delete_repo    # Supprimer vos repos si besoin
```

**Expiration** : 90 jours

### Contributeur open source

**Besoins** : Contribuer √† des projets publics, forker, cr√©er des PRs.

**Permissions recommand√©es** :
```
‚úÖ public_repo    # Repos publics seulement
‚úÖ user:email     # Pour les commits
```

**Expiration** : 1 an (moins de risque avec permissions limit√©es)

### Scripts d'automatisation

**Besoins** : Backup, synchronisation, rapports automatiques.

**Permissions recommand√©es** :
```
‚úÖ repo:status    # Lire le statut
‚úÖ repo           # Si backup complet n√©cessaire
‚úÖ read:org       # Informations organisation
```

**Expiration** : 1 an (avec rotation planifi√©e)

### CI/CD et d√©ploiement

**Besoins** : Tests automatiques, d√©ploiement, gestion des packages.

**Permissions recommand√©es** :
```
‚úÖ repo                # Code source
‚úÖ workflow            # GitHub Actions
‚úÖ write:packages      # Publier des packages
‚úÖ repo:status         # Statuts de build
```

**Expiration** : Pas d'expiration (mais surveillance)

### Administration d'√©quipe

**Besoins** : Gestion des membres, repositories, permissions.

**Permissions recommand√©es** :
```
‚úÖ repo                # Tous les repos
‚úÖ workflow            # GitHub Actions
‚úÖ admin:org           # Administration
‚úÖ user                # Profils utilisateurs
‚úÖ delete_repo         # Suppression si n√©cessaire
```

**Expiration** : 30-60 jours (rotation fr√©quente pour admin)

## üîÑ Gestion du cycle de vie des tokens

### Surveillance des tokens

#### Via GitHub.com
1. **Settings** ‚Üí **Developer settings** ‚Üí **Personal access tokens**
2. **V√©rifiez r√©guli√®rement** :
   - Tokens inutilis√©s (derni√®re utilisation)
   - Tokens expir√©s
   - Tokens avec trop de permissions

#### Via CLI
```bash
# Voir vos tokens actifs (partiellement)
gh auth status --show-token

# Tester un token
gh api user
```

### Rotation des tokens

**Bonnes pratiques de rotation** :

#### Rotation planifi√©e
```bash
#!/bin/bash
# rotate-token.sh

echo "üîÑ Rotation du token GitHub"

# 1. Cr√©er un nouveau token sur GitHub.com
echo "1. Cr√©ez un nouveau token sur GitHub avec les m√™mes permissions"
echo "2. Copiez le nouveau token"

# 2. Tester le nouveau token
echo -n "Nouveau token: "
read -s NEW_TOKEN
echo

echo "$NEW_TOKEN" | gh auth login --with-token

# 3. Tester
if gh api user > /dev/null 2>&1; then
    echo "‚úÖ Nouveau token fonctionnel"
    echo "4. R√©voquez l'ancien token sur GitHub.com"
else
    echo "‚ùå Probl√®me avec le nouveau token"
fi
```

#### Rotation d'urgence
```bash
# En cas de compromission
gh auth logout                    # D√©connexion imm√©diate
# R√©voquer sur GitHub.com        # Via l'interface web
gh auth login --with-token       # Nouveau token
```

### R√©vocation des tokens

#### Quand r√©voquer ?
- ‚úÖ **Token compromis** ou suspect√©
- ‚úÖ **Token inutilis√©** depuis longtemps
- ‚úÖ **Changement de poste** ou d'√©quipe
- ‚úÖ **Projet termin√©**

#### Comment r√©voquer ?
1. **GitHub.com** ‚Üí **Settings** ‚Üí **Developer settings** ‚Üí **Personal access tokens**
2. **Trouvez le token** dans la liste
3. **Cliquez sur "Delete"**
4. **Confirmez** la suppression

## üõ°Ô∏è S√©curit√© des tokens

### Stockage s√©curis√©

#### ‚úÖ Bonnes pratiques
```bash
# Gestionnaire de mots de passe
# - 1Password, Bitwarden, LastPass, etc.

# Variables d'environnement (temporaire)
export GITHUB_TOKEN="ghp_xxx"

# Fichiers avec permissions restreintes
echo "ghp_xxx" > ~/.github_token
chmod 600 ~/.github_token
```

#### ‚ùå √Ä √©viter absolument
```bash
# Dans le code source
const token = "ghp_xxx";  // ‚ùå JAMAIS !

# Dans les fichiers de configuration versionn√©s
# .env, config.yml, etc. commit√©s sur Git

# Dans les logs
echo "Token: ghp_xxx" > logfile.txt  // ‚ùå

# En plain text sans protection
echo "ghp_xxx" > token.txt  // ‚ùå
```

### D√©tection des fuites

#### GitHub scanning
GitHub **scanne automatiquement** :
- Repositories publics et priv√©s
- Commits, issues, PRs
- Logs de CI/CD

**Si un token est d√©tect√©**, GitHub :
1. **R√©voque automatiquement** le token
2. **Vous notifie** par email
3. **Cr√©e une alerte** de s√©curit√©

#### Outils de d√©tection
```bash
# TruffleHog - Scanner de secrets
pip install trufflehog
trufflehog --regex --entropy=False .

# git-secrets - Pr√©vention
git secrets --install
git secrets --register-aws
```

### Permissions minimales

**Toujours appliquer le principe de moindre privil√®ge** :

```bash
# ‚ùå Trop de permissions
repo, workflow, admin:org, delete_repo, user
# Pour un simple script de lecture

# ‚úÖ Permissions appropri√©es
public_repo, user:email
# Pour le m√™me script
```

## üîß Automatisation avec tokens

### Scripts de sauvegarde

```bash
#!/bin/bash
# backup-repos.sh

# Token avec permissions 'repo' et 'user'
GITHUB_TOKEN="${GITHUB_TOKEN}"

if [ -z "$GITHUB_TOKEN" ]; then
    echo "‚ùå Variable GITHUB_TOKEN requise"
    exit 1
fi

# Authentification
echo "$GITHUB_TOKEN" | gh auth login --with-token

# Sauvegarde
mkdir -p backup-$(date +%Y%m%d)
cd backup-$(date +%Y%m%d)

# Cloner tous vos repos
gh repo list --json name,sshUrl | jq -r '.[].sshUrl' | while read repo; do
    echo "Backup de $repo"
    git clone "$repo"
done

echo "‚úÖ Sauvegarde termin√©e"
```

### Monitoring automatique

```bash
#!/bin/bash
# check-repos.sh

# Token avec permissions minimales
export GITHUB_TOKEN="ghp_readonly_token"

# V√©rifier les repos avec issues ouvertes
echo "üìä Repositories avec issues ouvertes:"
gh search repos --owner="@me" --json name | \
    jq -r '.[].name' | \
    while read repo; do
        count=$(gh issue list --repo="$repo" --state=open --json number | jq length)
        if [ "$count" -gt 0 ]; then
            echo "  $repo: $count issues"
        fi
    done
```

### CI/CD avec tokens

**Exemple GitHub Actions** :

```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup GitHub CLI
        run: |
          echo "${{ secrets.DEPLOY_TOKEN }}" | gh auth login --with-token

      - name: Create release
        run: |
          gh release create v1.0.0 --generate-notes
```

## üîç Audit et conformit√©

### Audit r√©gulier

**Script d'audit mensuel** :

```bash
#!/bin/bash
# audit-tokens.sh

echo "üîç Audit des tokens GitHub - $(date)"
echo "================================="

# 1. Lister tous les tokens via l'interface web
echo "1. V√©rifiez manuellement sur GitHub.com:"
echo "   Settings ‚Üí Developer settings ‚Üí Personal access tokens"
echo ""

# 2. V√©rifier les tokens actifs
echo "2. Tokens actifs dans la CLI:"
gh auth status
echo ""

# 3. Tester les permissions
echo "3. Test des permissions actuelles:"
echo -n "  Acc√®s utilisateur: "
gh api user --jq .login && echo "‚úÖ" || echo "‚ùå"

echo -n "  Acc√®s repos: "
gh repo list --limit 1 >/dev/null 2>&1 && echo "‚úÖ" || echo "‚ùå"

echo -n "  Acc√®s workflow: "
gh api repos/:owner/:repo/actions/runs --jq .total_count >/dev/null 2>&1 && echo "‚úÖ" || echo "‚ùå"

echo ""
echo "4. Actions recommand√©es:"
echo "   - R√©voquez les tokens inutilis√©s"
echo "   - V√©rifiez les dates d'expiration"
echo "   - R√©duisez les permissions si possible"
```

### Documentation des tokens

**Maintenez un inventaire** :

```markdown
# Inventaire des tokens GitHub

| Nom | Usage | Permissions | Expiration | Statut |
|-----|-------|-------------|------------|--------|
| CLI-PC-Personnel | D√©veloppement local | repo, workflow, user | 2024-03-15 | ‚úÖ Actif |
| CI-Production | D√©ploiement auto | repo, workflow, packages | Aucune | ‚úÖ Actif |
| Script-Backup | Sauvegarde quotidienne | repo (lecture) | 2024-06-01 | ‚úÖ Actif |
| Test-Temporaire | Tests API | public_repo | 2024-01-15 | ‚ùå Expir√© |
```

## üö® Gestion des incidents

### Token compromis

**Actions imm√©diates** :

1. **R√©vocation** :
   ```bash
   # D√©connexion CLI
   gh auth logout

   # R√©vocation sur GitHub.com
   # Settings ‚Üí Developer settings ‚Üí Tokens ‚Üí Delete
   ```

2. **√âvaluation** :
   - Quelles donn√©es √©taient accessibles ?
   - Quelles actions ont pu √™tre effectu√©es ?
   - Y a-t-il eu des activit√©s suspectes ?

3. **Nouveau token** :
   ```bash
   # Cr√©er un nouveau token avec permissions minimales
   gh auth login --with-token
   ```

4. **Surveillance** :
   - V√©rifiez les logs GitHub
   - Surveillez les repositories pour des changements
   - Alertez l'√©quipe si n√©cessaire

### Perte de token

**Si vous perdez un token** :

```bash
# 1. Tentez de vous reconnecter
gh auth status

# 2. Si √©chec, nouvelle authentification
gh auth login

# 3. R√©voquez l'ancien token sur GitHub.com
# pour √©viter qu'il tra√Æne
```

## üìã R√©capitulatif des bonnes pratiques

### Cr√©ation de tokens
- ‚úÖ **Noms descriptifs** et explicites
- ‚úÖ **Permissions minimales** n√©cessaires
- ‚úÖ **Expiration appropri√©e** au contexte
- ‚úÖ **Documentation** de l'usage

### Utilisation
- ‚úÖ **Variables d'environnement** pour les scripts
- ‚úÖ **Gestionnaire de mots de passe** pour le stockage
- ‚úÖ **Jamais dans le code source** ou logs
- ‚úÖ **Test r√©gulier** du fonctionnement

### Maintenance
- ‚úÖ **Audit mensuel** des tokens actifs
- ‚úÖ **Rotation planifi√©e** des tokens critiques
- ‚úÖ **R√©vocation** des tokens inutilis√©s
- ‚úÖ **Surveillance** des alertes de s√©curit√©

### S√©curit√©
- ‚úÖ **2FA activ√©** sur le compte GitHub
- ‚úÖ **Principe de moindre privil√®ge**
- ‚úÖ **Monitoring** des activit√©s
- ‚úÖ **Plan de r√©ponse** aux incidents

## üéØ Prochaine √©tape

Vous ma√Ætrisez maintenant la gestion compl√®te des tokens d'acc√®s ! Il est temps de voir comment optimiser l'int√©gration avec votre √©diteur de code pr√©f√©r√©.

üëâ **Continuez avec** : [Configuration de l'√©diteur par d√©faut](04-configuration-de-lediteur-par-defaut.md)

---

*Vous avez termin√© la section 2.3 ! Vous savez maintenant cr√©er, g√©rer et s√©curiser vos tokens d'acc√®s GitHub comme un expert. Dans la prochaine section, nous optimiserons l'int√©gration avec votre √©diteur.*

‚è≠Ô∏è
