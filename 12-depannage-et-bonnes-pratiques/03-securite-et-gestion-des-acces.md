üîù Retour au [Sommaire](/SOMMAIRE.md)

# 12.3 S√©curit√© et gestion des acc√®s

## Introduction

La s√©curit√© est un aspect crucial de l'utilisation de la CLI GitHub, car elle vous donne acc√®s √† vos repositories, issues, PRs et potentiellement √† des informations sensibles de votre organisation. Cette section vous guide dans la mise en place de bonnes pratiques de s√©curit√© pour prot√©ger vos acc√®s et donn√©es.

## Comprendre les mod√®les d'authentification

### Types d'authentification GitHub CLI

**Authentification OAuth (recommand√©e) :**
- Utilise le navigateur web pour l'authentification
- G√©n√®re automatiquement des tokens s√©curis√©s
- Supporte l'authentification √† deux facteurs (2FA)
- Permissions granulaires

**Tokens d'acc√®s personnel (PAT) :**
- Cr√©√©s manuellement dans les param√®tres GitHub
- Contr√¥le total sur les permissions (scopes)
- Id√©aux pour l'automatisation et les scripts
- N√©cessitent une gestion manuelle

**Authentification SSH :**
- Utilise les cl√©s SSH existantes
- Principalement pour les op√©rations Git
- S√©curit√© √©lev√©e avec des cl√©s bien g√©r√©es

### V√©rifier votre authentification actuelle

```bash
# V√©rifier le statut d'authentification
gh auth status

# Voir les d√©tails complets
gh auth status --show-token

# V√©rifier les permissions du token
gh api user --jq '.permissions'
```

## Authentification s√©curis√©e

### M√©thode recommand√©e : OAuth web

```bash
# Authentification la plus s√©curis√©e
gh auth login --web

# Avec des scopes sp√©cifiques
gh auth login --web --scopes "repo,read:org"
```

**Avantages de l'authentification web :**
- ‚úÖ Support natif du 2FA
- ‚úÖ Interface utilisateur famili√®re
- ‚úÖ Permissions clairement affich√©es
- ‚úÖ R√©vocation facile depuis GitHub

### Cr√©ation de tokens d'acc√®s personnel s√©curis√©s

Si vous devez utiliser des PAT, suivez ces bonnes pratiques :

**√âtapes pour cr√©er un PAT s√©curis√© :**
1. Aller dans GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens
2. Choisir "Fine-grained tokens" (plus s√©curis√©) ou "Tokens (classic)"
3. D√©finir une expiration courte (30-90 jours maximum)
4. S√©lectionner uniquement les permissions n√©cessaires
5. Limiter l'acc√®s aux repositories sp√©cifiques si possible

**Utilisation du token :**
```bash
# Authentification avec token (m√©thode s√©curis√©e)
echo "your_token_here" | gh auth login --with-token

# √âviter absolument cette m√©thode (non s√©curis√©e)
# gh auth login --with-token your_token_here
```

## Gestion des permissions et scopes

### Comprendre les scopes essentiels

**Scopes de base :**
- `repo` : Acc√®s complet aux repositories priv√©s
- `public_repo` : Acc√®s aux repositories publics uniquement
- `read:org` : Lire les informations d'organisation
- `user` : Acc√®s aux informations de profil

**Scopes avanc√©s :**
- `admin:org` : Administration d'organisation
- `delete_repo` : Suppression de repositories
- `workflow` : Gestion des GitHub Actions

### Principe du moindre privil√®ge

```bash
# Exemple : Pour un script qui lit seulement les issues publiques
gh auth login --scopes "public_repo,read:user"

# Exemple : Pour l'administration d'une organisation
gh auth login --scopes "repo,admin:org,read:user"

# V√©rifier les scopes accord√©s
gh auth status
```

### Audit des permissions

```bash
# V√©rifier les permissions actuelles
gh api user --jq '.permissions'

# Lister les repositories accessibles
gh repo list --limit 100

# V√©rifier l'acc√®s √† une organisation
gh api orgs/your-org/members/your-username
```

## S√©curisation des tokens

### Stockage s√©curis√©

**√âviter absolument :**
- ‚ùå Tokens en dur dans les scripts
- ‚ùå Tokens dans les variables d'environnement globales
- ‚ùå Tokens dans les fichiers de configuration versionn√©s
- ‚ùå Partage de tokens par email/chat

**Bonnes pratiques :**
```bash
# Utiliser des fichiers prot√©g√©s
echo "your_token" > ~/.github_token
chmod 600 ~/.github_token

# Dans les scripts, lire depuis un fichier s√©curis√©
GITHUB_TOKEN=$(cat ~/.github_token)
export GITHUB_TOKEN

# Ou utiliser des gestionnaires de secrets
# macOS Keychain, Windows Credential Manager, Linux Keyring
```

### Variables d'environnement s√©curis√©es

```bash
# Dans votre .bashrc/.zshrc (pour usage local uniquement)
export GITHUB_TOKEN=$(security find-generic-password -s github_token -w 2>/dev/null)

# Pour les scripts temporaires
read -s -p "GitHub Token: " GITHUB_TOKEN
export GITHUB_TOKEN
```

### Rotation des tokens

```bash
# Script de rotation automatique des tokens
#!/bin/bash
rotate_github_token() {
    echo "üîÑ Rotation du token GitHub"

    # D√©connexion actuelle
    gh auth logout

    # Nouvelle authentification
    gh auth login --web

    # V√©rification
    if gh auth status; then
        echo "‚úÖ Token rotated successfully"
    else
        echo "‚ùå Token rotation failed"
    fi
}
```

## S√©curit√© des acc√®s multi-comptes

### Isolation des comptes

```bash
# Configurer des profils s√©par√©s
# Compte personnel
gh auth login --hostname github.com --username personal-account

# Compte professionnel
gh auth login --hostname github.com --username work-account

# Basculer entre les comptes
gh auth switch --hostname github.com --user personal-account
gh auth switch --hostname github.com --user work-account
```

### Configuration par projet

```bash
# Dans un projet sp√©cifique
cd /path/to/work/project

# Utiliser un token sp√©cifique pour ce projet
export GITHUB_TOKEN=$(cat ~/.tokens/work-token)

# Ou cr√©er un script d'environnement
cat > .env << 'EOF'
#!/bin/bash
export GITHUB_TOKEN=$(cat ~/.tokens/work-token)
export GH_HOST=github.com
echo "üè¢ Environment work configured"
EOF

source .env
```

## S√©curit√© des extensions

### √âvaluation de la s√©curit√© des extensions

Avant d'installer une extension, v√©rifiez :

```bash
# V√©rifier la popularit√© et la maintenance
gh extension browse

# Examiner le code source
gh repo view owner/gh-extension-name

# V√©rifier l'auteur et l'organisation
gh api repos/owner/gh-extension-name --jq '.owner.login'

# Voir les permissions demand√©es (si document√©es)
gh repo view owner/gh-extension-name --web
```

**Crit√®res de s√©curit√© :**
- ‚úÖ Auteur reconnu ou organisation officielle
- ‚úÖ Code source ouvert et auditable
- ‚úÖ Maintenance active (commits r√©cents)
- ‚úÖ Documentation claire des permissions
- ‚úÖ Issues de s√©curit√© trait√©es rapidement

### Installation s√©curis√©e d'extensions

```bash
# Installer uniquement des extensions de confiance
gh extension install dlvhdr/gh-dash  # Auteur reconnu

# √âviter les extensions avec des warning de s√©curit√©
# V√©rifier les issues GitHub de l'extension

# Audit p√©riodique des extensions
gh extension list
```

### Nettoyage des extensions

```bash
# Supprimer les extensions non utilis√©es
gh extension remove unused-extension

# Audit complet
gh extension list | while read ext; do
    echo "Extension: $ext"
    echo "Last used: ?" # Documenter votre usage
done
```

## S√©curit√© r√©seau et communications

### Configuration HTTPS vs SSH

**HTTPS avec authentification :**
```bash
# Configuration s√©curis√©e HTTPS
gh config set git_protocol https

# V√©rifier les certificats SSL
curl -I https://api.github.com
```

**SSH (recommand√© pour la s√©curit√©) :**
```bash
# Configuration SSH s√©curis√©e
gh config set git_protocol ssh

# V√©rifier la configuration SSH
ssh -T git@github.com

# Configuration SSH s√©curis√©e (~/.ssh/config)
Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/id_rsa_github
    IdentitiesOnly yes
    AddKeysToAgent yes
    UseKeychain yes  # macOS seulement
```

### Protection contre les attaques r√©seau

```bash
# V√©rifier les certificats SSL
openssl s_client -connect api.github.com:443 -servername api.github.com

# Utiliser des DNS s√©curis√©s
# Configuration selon votre OS pour utiliser 1.1.1.1 ou 8.8.8.8

# √âviter les r√©seaux non s√©curis√©s pour les op√©rations sensibles
```

## Audit et monitoring de s√©curit√©

### Surveillance des acc√®s

```bash
# Script d'audit de s√©curit√©
#!/bin/bash
echo "üîç Audit de s√©curit√© GitHub CLI"
echo "==============================="

echo "üìä Informations d'authentification :"
gh auth status

echo ""
echo "üîë Tokens actifs :"
gh api user/tokens 2>/dev/null || echo "Non accessible via API"

echo ""
echo "üîå Extensions install√©es :"
gh extension list

echo ""
echo "‚öôÔ∏è Configuration actuelle :"
gh config list

echo ""
echo "üåê Test de connectivit√© s√©curis√©e :"
curl -I https://api.github.com | head -n 1
```

### Logs de s√©curit√©

```bash
# Activer les logs pour audit
export GH_DEBUG=1

# Rediriger les logs vers un fichier s√©curis√©
gh command 2>> ~/.logs/gh-security.log

# Prot√©ger les logs
chmod 600 ~/.logs/gh-security.log
```

### D√©tection d'activit√© suspecte

```bash
# V√©rifier les connexions r√©centes (sur GitHub web)
# Settings ‚Üí Security ‚Üí Sign-in log

# Script de v√©rification automatique
check_suspicious_activity() {
    # V√©rifier les ratios d'API inhabituels
    CURRENT_RATE=$(gh api rate_limit --jq '.rate.remaining')
    if [ "$CURRENT_RATE" -lt 100 ]; then
        echo "‚ö†Ô∏è Warning: Low API rate limit remaining"
    fi

    # V√©rifier l'acc√®s aux repositories critiques
    gh repo view critical-repo > /dev/null 2>&1 || echo "‚ùå Cannot access critical repo"
}
```

## S√©curit√© en environnement CI/CD

### Configuration s√©curis√©e pour l'int√©gration continue

```bash
# Dans les pipelines CI/CD
# Utiliser des secrets d'environnement, jamais de tokens en dur

# GitHub Actions example
env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

# Configuration pour CI
export GH_PROMPT_DISABLED=1
export NO_COLOR=1

# Limiter les permissions au strict n√©cessaire
# Utiliser des tokens avec scopes minimal pour CI
```

### Bonnes pratiques CI/CD

```bash
# Script s√©curis√© pour CI
#!/bin/bash
set -euo pipefail  # Strict error handling

# V√©rifier que le token est pr√©sent
if [ -z "${GITHUB_TOKEN:-}" ]; then
    echo "‚ùå GITHUB_TOKEN not set"
    exit 1
fi

# V√©rifier la validit√© du token
if ! gh auth status; then
    echo "‚ùå Invalid GitHub token"
    exit 1
fi

# Effectuer les op√©rations avec permissions minimales
gh repo list --limit 1 > /dev/null || exit 1
```

## Incident response et r√©cup√©ration

### En cas de compromission suspect√©e

**Actions imm√©diates :**
```bash
# 1. D√©connecter tous les acc√®s
gh auth logout

# 2. R√©voquer les tokens depuis GitHub web
# Settings ‚Üí Developer settings ‚Üí Personal access tokens

# 3. Changer les mots de passe GitHub
# Settings ‚Üí Password and authentication

# 4. V√©rifier l'activit√© r√©cente
# Settings ‚Üí Security log
```

### Proc√©dure de r√©cup√©ration

```bash
# 1. Nettoyer la configuration locale
rm -rf ~/.config/gh/
rm -rf ~/.cache/gh/

# 2. R√©authentification s√©curis√©e
gh auth login --web --scopes "repo,read:user"

# 3. Audit complet
gh auth status
gh config list
gh extension list

# 4. Reconfiguration s√©curis√©e
gh config set git_protocol ssh
```

### Documentation d'incident

```bash
# Template de rapport d'incident
cat > incident-report.md << 'EOF'
# Incident de s√©curit√© GitHub CLI

## Date et heure
- D√©tection :
- R√©solution :

## Description
- Sympt√¥mes observ√©s :
- Cause suspect√©e :

## Actions prises
- [ ] D√©connexion des acc√®s
- [ ] R√©vocation des tokens
- [ ] Audit des activit√©s
- [ ] Reconfiguration

## Pr√©vention future
- Mesures √† mettre en place :
- Formation n√©cessaire :
EOF
```

## Bonnes pratiques de s√©curit√© au quotidien

### Check-list de s√©curit√© quotidienne

**Avant de commencer le travail :**
- ‚úÖ V√©rifier l'authentification : `gh auth status`
- ‚úÖ Contr√¥ler l'environnement r√©seau (√©viter WiFi public)
- ‚úÖ V√©rifier les extensions install√©es

**Pendant le travail :**
- ‚úÖ Utiliser des permissions minimales
- ‚úÖ Ne jamais partager de tokens
- ‚úÖ √âviter les commandes avec donn√©es sensibles dans l'historique

**Fin de session :**
- ‚úÖ Nettoyer les variables d'environnement sensibles
- ‚úÖ Fermer les sessions sur machines partag√©es
- ‚úÖ V√©rifier l'activit√© dans GitHub web

### Formation et sensibilisation

**Pour vous-m√™me :**
- Restez inform√© des alertes de s√©curit√© GitHub
- Participez aux formations de s√©curit√©
- Lisez les bonnes pratiques r√©guli√®rement

**Pour votre √©quipe :**
- Partagez les proc√©dures de s√©curit√©
- Organisez des sessions de formation
- Cr√©ez des guides internes
- √âtablissez des protocoles d'incident

## Configuration s√©curis√©e d'√©quipe

### Standards de s√©curit√© d'√©quipe

```bash
# Script de configuration s√©curis√©e pour l'√©quipe
#!/bin/bash
echo "üîí Configuration s√©curis√©e GitHub CLI - √âquipe"

# Configuration de base s√©curis√©e
gh config set git_protocol ssh
gh config set prompt enabled

# Alias s√©curis√©s (sans donn√©es sensibles)
gh alias set secure-status "auth status"
gh alias set audit-config "config list"

# Extensions approuv√©es seulement
echo "üìù Extensions approuv√©es :"
echo "- dlvhdr/gh-dash"
echo "- mislav/gh-branch"
echo "Demander approbation pour d'autres extensions"

echo "‚úÖ Configuration termin√©e"
echo "üìñ Voir le guide de s√©curit√© interne pour plus de d√©tails"
```

---

**üéØ Points cl√©s √† retenir :**
- Utilisez toujours l'authentification web avec 2FA quand possible
- Appliquez le principe du moindre privil√®ge pour les tokens
- Auditez r√©guli√®rement vos acc√®s et extensions
- Prot√©gez vos tokens comme des mots de passe
- Documentez les incidents et partagez les bonnes pratiques

**üîí R√®gle d'or de s√©curit√© :** En cas de doute sur la s√©curit√© d'un token ou d'un acc√®s, r√©voque imm√©diatement et reconfigure proprement.

**‚û°Ô∏è Prochaine √©tape :** Dans la section 12.4, nous explorerons les conseils pour les √©quipes et l'adoption √† grande √©chelle de la CLI GitHub.

‚è≠Ô∏è
